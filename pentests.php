<!DOCTYPE html>
<html>
  <head>
    <?php include('common/vars.php'); ?>
  </head>
    <?php include('common/functions.php');
          include('common/header.php');

$conn = new mysqli(DBHOST, DBUSER, DBPASS, DBNAME);

// NEW
if ($_POST["action"] == "new") {
  $run = 1;
} // END NEW

// DELETE BY ID
if ($_POST["action"] == "delete") {
  $id = $_POST["id"];

  $sql = "DELETE FROM pentests WHERE id=$id";
  if ($conn->query($sql) === TRUE) {
    showToastMessage("Pentest deleted successfully!");
  }
} // END DELETE BY ID

// RESULT(S) PENTEST
if ($_POST["action"] == "run") {
  $t = explode(" ",microtime());
  $startTime = microtime(true);
  $run = 2;

  $idmodel = $_POST["idmodel"];

  // Get last id pentest
  $sql = "SELECT id FROM pentests ORDER BY id DESC LIMIT 1";
  $result = $conn->query($sql);
  $row = $result->fetch_assoc();

  $idpentest = $row['id'] + 1;

  $namePentest = $_POST["name"];
  $descriptionPentest = $_POST["description"];
  $notesPentest = $_POST["notes"];

  $sql = "SELECT * FROM models WHERE id = $idmodel";
  $result = $conn->query($sql);
  $row = $result->fetch_assoc();

  $nameModel= $row['name'];
  $descriptionModel = $row['description'];

  $commands = explode("\n", str_replace("\r", "", $row['commands']));
  $idtools = explode("\n", str_replace("\r", "", $row['idtools']));
  // If exists, remove last value array $idtools, with nothing: \n
  if (end($idtools) == '') {
    array_pop($idtools);
  }

  $port = $_POST["ports"];
  $host = $_POST["host"];
  $network = $_POST["network"];
  $domain = $_POST["domain"];

}
 
// REPEAT PENTEST
if ($_POST["action"] == "repeat") { // || $_POST["action"] == "report") {
  //if ($_POST["action"] == "repeat") { 
  $run = 3; // }
  
  $t = explode(" ",microtime());
  $startTime = microtime(true);
  $idpentest = $_POST["idpentest"]; 

  $sql = "SELECT * FROM pentests WHERE id = $idpentest";
  $result = $conn->query($sql);
  $row = $result->fetch_assoc();

  $userPentest = $row['user'];
  $datePentest = $row['date'];
  $namePentest = $row['name'];
  $descriptionPentest = $row['description'];
  $idmodel = $row['idmodel'];
  $port = $row['port'];
  $host = $row['host'];
  $network = $row['network'];
  $domain = $row['domain'];
  $commandsPentest = explode('","', $row['commands']);
  $notesPentest = $row['notes'];

  $resultPentest = explode('","', $row['result']);

  $sql = "SELECT * FROM models WHERE id = $idmodel";
  $result = $conn->query($sql);
  $row = $result->fetch_assoc();

  $nameModel= $row['name'];
  $descriptionModel = $row['description'];
  $commands = explode("\n", str_replace("\r", "", $row['commands']));
  $idtools = explode("\n", str_replace("\r", "", $row['idtools']));
  // If exists, remove last value array $idtools, with nothing: \n
  if (end($idtools) == '') {
    array_pop($idtools);
  }
  $notesModel = $row['notes'];

} 

// VIEW BY ID
if ($_POST["action"] == "view") {
  $run = 4;

  $idpentest = $_POST["id"]; 

  $sql = "SELECT * FROM pentests WHERE id = $idpentest";
  $result = $conn->query($sql);
  $row = $result->fetch_assoc();

  $userPentest = $row['user'];
  $datePentest = $row['date'];
  $namePentest = $row['name'];
  $descriptionPentest = $row['description'];
  $idmodel = $row['idmodel'];
  $port = $row['port'];
  $host = $row['host'];
  $network = $row['network'];
  $domain = $row['domain'];
  $commandsPentest = explode('","', $row['commands']);
  $notesPentest = $row['notes'];
  $resultPentest = explode("\"]", $row['result']);
  $resultXml = explode('",', $row['resultxml']);
  $elapsedtime = $row['elapsedtime'];

  $sql = "SELECT * FROM models WHERE id = $idmodel";
  $result = $conn->query($sql);
  $row = $result->fetch_assoc();

  $nameModel= $row['name'];
  $descriptionModel = $row['description'];
  $commands = explode("\n", str_replace("\r", "", $row['commands']));
  $idtools = explode("\n", str_replace("\r", "", $row['idtools']));
  // If exists, remove last value array $idtools, with nothing: \n
  if (end($idtools) == '') {
    array_pop($idtools);
  }
  $notesModel = $row['notes'];

} // END VIEW BY ID

?>

<!-- !PAGE CONTENT! -->
<div class="w3-main animate-bottom" style="margin-left:270px;margin-top:43px;">
  <?php

  // run == 0 > Mostra tabela 
  if ($run == 0) {
    showPageTitle('Pentests » List','fa-shield'); ?>

    <div class="w3-container">
      <div class="w3-row-padding w3-margin-bottom" style="margin-right: 20px;">
        <div class="w3-container w3-white w3-card-4 w3-padding-16">

          <form method="post" class="w3-container" action="<?php $_PHP_SELF ?>" style="background-color: #ffa366; border-radius: 14px; margin-bottom: 20px; padding: 10px;">
            <input name="action" type="hidden" value="new">
            <button class="w3-btn w3-orange" type="submit"><i class='fa fa-plus-circle'></i>New</button>
          </form>
          
          <?php showFilterTable(""); ?>

          <table class="w3-table w3-bordered w3-border w3-hoverable w3-white" id="table">
            <?php 
            $sql = "SELECT id, date, user, name FROM pentests ORDER BY date DESC";
            $result = $conn->query($sql);
            echo "<thead>";
              echo "<tr>";
                echo "<th><strong># &nbsp; &nbsp; &nbsp; Name </strong></th>";
                echo "<th><strong> User </strong></th>";
                echo "<th><strong> Date </strong></th>";
                echo "<th></th>";
              echo "</tr>";
            echo "</thead>";
            echo "<tbody id='tableList'>";
              $count = 1;
              while ($row = $result->fetch_assoc()) {
                unset($id, $date, $user, $name);
                $id = $row['id']; 
                $date = $row['date']; 
                $user = $row['user'];
                $name = $row['name'];
                echo "<tr>";
                  echo "<td><strong>$count</strong> &nbsp; &nbsp; $name</td>";
                  echo "<td>$user</td>";
                  echo "<td>$date</td>"; ?> 
                  <td>
                    <!-- ICON VIEW -->
                    <button onclick="document.getElementById('formview<?php echo $id; ?>').style.display='block'" class="w3-button w3-large"><i class="fa fa-eye"></i></button>
                    <!-- ICON DELETE -->
                    <button onclick="document.getElementById('formdel<?php echo $id; ?>').style.display='block'" class="w3-button w3-large"><i class="fa fa-trash-o"></i></button>
                    <!-- ICON REPEAT -->
                    <button onclick="document.getElementById('formrepeat<?php echo $id; ?>').style.display='block'" class="w3-button w3-large"><i class="fa fa-refresh"></i></button>
                    <!-- ICON REPORT -->
                    <button onclick="document.getElementById('formreport<?php echo $id; ?>').style.display='block'" class="w3-button w3-large"><i class="fa fa-file-text-o"></i></button>

                    <div id="formview<?php echo $id; ?>" class="w3-modal"> <!-- por omissão: display: none -->
                      <div class="w3-modal-content w3-card-4 w3-animate-zoom" style="max-width:330px; border-radius: 10px;">
                        <div class="w3-center" style="padding-top: 10px;">
                          <h5>View pentest?</h5>
                          <form id="form" method="post" class="w3-container" action="<?php $_PHP_SELF ?>" style="padding-bottom: 20px;">
                            <input name="id" type="hidden" value="<?php echo $id; ?>">
                            <input name="action" type="hidden" value="view">
                            <button style="width: 100px;" class="w3-btn w3-orange" type="submit" onclick="document.getElementById('formview<?php echo $id; ?>').style.display='none'; document.getElementById('pro').style.display='block'"><i class='fa fa-check-circle'></i>Yes</button>
                            <button style="width: 100px;" type="button" class="w3-btn w3-orange" onclick="document.getElementById('formview<?php echo $id; ?>').style.display='none'"><i class='fa fa-times-circle'></i>No</button>
                          </form>
                        </div>
                      </div>
                    </div>
                    
                    <div id="formdel<?php echo $id; ?>" class="w3-modal"> <!-- por omissão: display: none -->
                      <div class="w3-modal-content w3-card-4 w3-animate-zoom" style="max-width:330px; border-radius: 10px;">
                        <div class="w3-center" style="padding-top: 10px;">
                          <h5>Delete pentest?</h5>
                          <form id="form" method="post" class="w3-container" action="<?php $_PHP_SELF ?>" style="padding-bottom: 20px;">
                            <input name="id" type="hidden" value="<?php echo $id; ?>">
                            <input name="action" type="hidden" value="delete">
                            <button style="width: 100px;" class="w3-btn w3-orange" type="submit" onclick="document.getElementById('formdel<?php echo $id; ?>').style.display='none'; document.getElementById('pro').style.display='block'"><i class='fa fa-check-circle'></i>Yes</button>
                            <button style="width: 100px;" type="button" class="w3-btn w3-orange" onclick="document.getElementById('formdel<?php echo $id; ?>').style.display='none'"><i class='fa fa-times-circle'></i>No</button>
                          </form>
                        </div>
                      </div>
                    </div>

                    <div id="formrepeat<?php echo $id; ?>" class="w3-modal"> <!-- por omissão: display: none -->
                      <div class="w3-modal-content w3-card-4 w3-animate-zoom" style="max-width:330px; border-radius: 10px;">
                        <div class="w3-center" style="padding-top: 10px;">
                          <h5>Repeat pentest?</h5>
                          <form id="form" method="post" class="w3-container" action="<?php $_PHP_SELF ?>" style="padding-bottom: 20px;">
                            <input name="idpentest" type="hidden" value="<?php echo $id; ?>">
                            <input name="action" type="hidden" value="repeat">
                            <button style="width: 100px;" class="w3-btn w3-orange" type="submit" onclick="document.getElementById('formrepeat<?php echo $id; ?>').style.display='none'; document.getElementById('pro').style.display='block'"><i class='fa fa-check-circle'></i>Yes</button>
                            <button style="width: 100px;" type="button" class="w3-btn w3-orange" onclick="document.getElementById('formrepeat<?php echo $id; ?>').style.display='none'"><i class='fa fa-times-circle'></i>No</button>
                          </form>
                        </div>
                      </div>

                    </div>
                    <div id="formreport<?php echo $id; ?>" class="w3-modal"> <!-- por omissão: display: none -->
                      <div class="w3-modal-content w3-card-4 w3-animate-zoom" style="max-width:330px; border-radius: 10px;">
                        <div class="w3-center" style="padding-top: 10px;">
                          <h5>Create report?</h5>
                          <form id="form" method="post" class="w3-container" action="Reports.php?tab=Reports" style="padding-bottom: 20px;">
                            <input name="idpentest" type="hidden" value="<?php echo $id; ?>">
                            <input name="action" type="hidden" value="report">
                            <button style="width: 100px;" class="w3-btn w3-orange" type="submit" onclick="document.getElementById('formreport<?php echo $id; ?>').style.display='none'; document.getElementById('pro').style.display='block'"><i class='fa fa-check-circle'></i>Yes</button>
                            <button style="width: 100px;" type="button" class="w3-btn w3-orange" onclick="document.getElementById('formreport<?php echo $id; ?>').style.display='none'"><i class='fa fa-times-circle'></i>No</button>
                          </form>
                        </div>
                      </div>

                    </div>
                  </td>
                </tr>
                <?php $count++;
              } ?>
            </tbody>
          </table><br>
        </div>
      </div>
    </div>

  <?php }
  // run == 1 > Mostra New Pentest
  if ($run == 1) {
    showPageTitle('Pentests » New','fa-shield'); ?>

    <div class="w3-container">
      <div class="w3-row-padding w3-margin-bottom" style="margin-right: 20px;">
        <div class="w3-container w3-white w3-card-4 w3-padding-16">

          <form id="toHide" method="post" class="w3-container" action="<?php $_PHP_SELF ?>" style="background-color: #ffa366; border-radius: 14px; margin-bottom: 20px; padding: 10px;">
            <button class="w3-btn w3-orange" type="submit"><i class='fa fa-list-ul'></i>Show List</button>
          </form>

          <div class="w3-row-padding">
            
            <?php showSubTitle('Pentest:'); ?>       
            <div class="w3-quarter">
              <input type="text" id="name1" placeholder="Name">
            </div>
            <div class="w3-half">
              <input type="text" id="description1" placeholder="Description"> 
            </div>

            <?php // SELECT WITH MODELS
            $sql = "SELECT id, name, description, commands, alert FROM models ORDER BY name ASC";
            $result = $conn->query($sql); ?>

            <?php // CHOOSE MODEL
            showSubTitle('Model:'); ?>
           
            <div class="w3-threequarter">
              <select onchange="modelChange(this);" id="models" name="models">
                <option value="none">Select...</option>
                <?php while ($row = $result->fetch_assoc()) {
                  $cmds1 = explode("\n", str_replace("\r", "", $row['commands']));
                  $i=0; $cmds = "";
                  while ($i < count($cmds1, true)) {
                    $cmds = $cmds . $cmds1[$i] . "<br>";
                    $i++;
                  }
                  // Remove last <br>
                  $cmds = substr_replace($cmds,'', -1); ?>
                  <option value="<?php echo $row['id']; ?>" name="<?php echo $row['name']; ?>" commands="<?php echo $cmds; ?>" alert="<?php echo $row['alert']; ?>"><?php echo $row['name'] . " (".$row['description'].")"; ?></option>
                <?php } ?>     
              </select>
            </div>

            <div class="w3-quarter" style="display: flex;">
              <!-- // Show commands from selected model, on tooltip text -->
              <i id="helpCommands<?php echo $row['id'] ?>" style="display: none; padding: 6px 0; color:<?php echo COLOR_ORANGE; ?>" class="tooltip fa fa-exclamation-circle fa-lg">
              <span class="tooltiptext" style="width: 400px; margin-left: -200px;"><p id="textHelpCommands" style="margin: 5px 0;"></p></span>
              </i>

              <!-- EDIT MODEL -->
              <form target="result" method="post" class="w3-container" action="Models.php?tab=Models" style="padding: 0;" onsubmit="window.open('','result','width=844,height=680,resizable=no');">
                <input name="id" id="id" type="hidden" value="">
                <input name="action" type="hidden" value="edit">
                <input name="windowFromEdit" type="hidden">
                <button class="w3-button" style="padding: 0px;"><i id="editmodel" style="color: #FF6400;display: none; padding: 2px 11px 0 10px;" class='fa fa-pencil-square-o fa-lg'></i></button>
              </form>          
            </div>

            <!-- Alert Tools -->
            <div> <p id="alertText"></p> </div>
          
          </div>
          <div class="w3-row-padding">
            <?php showSubTitle('Values for tools parameters:'); ?>
            
            <div class="w3-row" style="padding-bottom: 5px;">
              <div class="w3-quarter">
                <p style="text-align: right; margin: 3px 20px;">Port(s) Number(s):</p>
              </div>
              <div class="w3-threequarter">
                <select style="width:200px;" id="ports_list" onchange="otherServiceCheck(this);">
                  <option>Use defined ports</option>
                  <option value="other">Other</option>
                </select>
                <i id="helpService" style="padding: 0 10px; color:<?php echo COLOR_ORANGE; ?>" class="tooltip fa fa-exclamation-circle fa-lg">
                  <span class="tooltiptext"><?php echo PORTS_TIP ?></span>
                </i>
                <input name="service_input" type="text" id="otherService" style="margin-top: 1px; visibility:hidden; width:200px;" placeholder="20,25,53,80..."/>
              </div>
            </div>

            <div class="w3-row" style="padding-bottom: 5px;">
              <div class="w3-quarter">
                <p style="text-align: right; margin: 3px 20px;">Host:</p>
              </div>
              <div class="w3-threequarter">
                <select style="width:200px;" id="ip_list" onchange="otherIpCheck(this);">
                  <?php $output = shell_exec($get_local_ips);
                  $int_array = preg_split('#[\r\n]+#', trim($output));
                  for ($i = 0; $i < count($int_array); $i++) {
                    if (preg_match('/\badapter\b/',$int_array[$i])) {
                      if (preg_match('/\bAddress\b/',$int_array[$i+1])) {
                        $int_ip = end(explode('. : ', $int_array[$i+1]));
                        echo "<option value=$int_ip>$int_ip (local)</option>";
                      }
                      // VER IP REDE CORRETAMENTE !!!
                      // https://pplware.sapo.pt/tutoriais/networking/redes-como-calcular-sub-redes/
                    }
                  } ?>
                  <option value="other">Other</option>
                </select>
                <i id="helpIp" style="padding: 0 10px; color:<?php echo COLOR_ORANGE; ?>" class="tooltip fa fa-exclamation-circle fa-lg">
                  <span class="tooltiptext"><?php echo HOST_TIP ?></span>
                </i>
                <input type="text" id="otherIp" style="margin-top: 1px; visibility:hidden; width:200px;" placeholder="192.168.1.1"/>
              </div>
            </div>

            <div class="w3-row" style="padding-bottom: 5px;">
              <div class="w3-quarter">
                <p style="text-align: right; margin: 3px 20px;">Network:</p>
              </div>
              <div class="w3-threequarter">
                <input name="network1" type="text" id="network1" style="width:200px;" placeholder="192.168.1.0/24" value="<?php echo "192.168.1.0/24"; ?>" />
              </div>
            </div>

            <div class="w3-row" style="padding-bottom: 5px;">
              <div class="w3-quarter">
                <p style="text-align: right; margin: 3px 20px;">Domain:</p>
              </div>
              <div class="w3-threequarter">
                <input name="domain1" type="text" id="domain1" style="width:200px;" placeholder="example.com" value="<?php echo "ipleiria.pt"; ?>" />
              </div>
            </div>

            <?php showSubTitle('Notes:'); ?>
            <div class="w3-row-padding">
              <div class="w3-threequarter">
                <textarea rows="6" name="notes1" id="notes1" placeholder="Notes" style="width: 93%;"></textarea>
              </div>
            </div>
             
            <form method="post" action="<?php $_PHP_SELF ?>">
              <input type="hidden" name="action" value="run">
              <input type="hidden" name="name" id="name" value="">
              <input type="hidden" name="description" id="description" value="">
              <input type="hidden" name="idmodel" id="idmodel" value="">
              <input type="hidden" name="ports" id="ports" value="">
              <input type="hidden" name="host" id="host" value="">
              <input type="hidden" name="network" id="network" value="">
              <input type="hidden" name="domain" id="domain" value="">
              <input type="hidden" name="notes" id="notes" value="">
              
              <button style="margin-top: 13px;" type="submit" class="w3-btn w3-orange" onclick="document.getElementById('pro').style.display='block'; actionStart();" id="buttonStart" disabled><i class='fa fa-play-circle'></i>Start</button>
            </form>
          </div>
        </div>
      </div>
    </div>

  <?php }
  // run == 2 > Run pentest   ||  run == 3 > Repeat pentest  ||  run == 4 > View pentest
  if ($run == 2 || $run == 3 || $run == 4) {
    if ($run == 2) { $type = "Result of the execution"; }
    if ($run == 3) { $type = "Repeat pentest"; }
    if ($run == 4) { $type = "View executed pentest"; }

    showPageTitle('Pentests » ' . $type,'fa-shield'); ?>

    <div class="w3-container">
      <div class="w3-row-padding w3-margin-bottom" style="margin-right: 20px;">
        <div class="w3-container w3-white w3-card-4 w3-padding-16">
          <div class="w3-row">
            <form id="formNewPentest" method="post" action="<?php $_PHP_SELF ?>" style="background-color: #ffa366; border-radius: 14px; margin-bottom: 20px; padding: 10px;">
              <input name="action" type="hidden" value="new">
              <button class="w3-btn w3-orange" type="submit" form="formNewPentest"><i class='fa fa-plus-circle'></i>New</button>
              <button class="w3-btn w3-orange" type="submit" form="formShowList"><i class='fa fa-list-ul'></i>Show List</button>
              <button class="w3-btn w3-orange" onclick="document.getElementById('formreport').style.display='block'"><i class='fa fa-file-text-o'></i>Report</button>
            </form>
            
            <form id="formShowList" method="post" action="<?php $_PHP_SELF ?>" style="padding: 0px;">
            </form>
          </div>

          <div id="formreport" class="w3-modal"> <!-- por omissão: display: none -->
            <div class="w3-modal-content w3-card-4 w3-animate-zoom" style="max-width:330px; border-radius: 10px;">
              <div class="w3-center" style="padding-top: 10px;">
                <h5>Create report?</h5>
                <form id="form" method="post" class="w3-container" action="Reports.php?tab=Reports" style="padding-bottom: 20px;">
                  <input name="idpentest" type="hidden" value="<?php echo $idpentest; ?>">
                  <input name="action" type="hidden" value="report">
                  <button style="width: 100px;" class="w3-btn w3-orange" type="submit" onclick="document.getElementById('formreport<?php echo $id; ?>').style.display='none'; document.getElementById('pro').style.display='block'"><i class='fa fa-check-circle'></i>Yes</button>
                  <button style="width: 100px;" type="button" class="w3-btn w3-orange" onclick="document.getElementById('formreport<?php echo $id; ?>').style.display='none'"><i class='fa fa-times-circle'></i>No</button>
                </form>
              </div>
            </div>
          </div>

          <div id="showToastMessage" class="w3-row-padding">
            <?php 

            runCommands($type, $namePentest, $descriptionPentest, $port, $host, $network, $domain, $idmodel, $idtools, $nameModel, $descriptionModel, $commands, $notesPentest, $startTime, $elapsedtime, $resultPentest, $resultXml);

            ?>
          </div>
        </div>
      </div>
    </div>
  <?php } ?>
</div>

<?php $run = 0; $conn->close(); ?>

<script type="text/javascript">

  var acc = document.getElementsByClassName("accordion");
  var i;

  for (i = 0; i < acc.length; i++) {
    acc[i].addEventListener("click", function() {
      this.classList.toggle("active");
      var panel = this.nextElementSibling;
      if (panel.style.maxHeight){
        panel.style.maxHeight = null;
      } else {
        panel.style.maxHeight = panel.scrollHeight + "px";
      } 
    });
  }

  // FILTRA PELO ID SELECIONADO DE MODELS, SE ALGUMA TOOL TEM ALERT
  $("#tools1").change(function() {
    var id = $(this).val();

    if ($(this).data('options1') == undefined) {
      $(this).data('options1', $('#parameters option').clone());
    }
    var options1 = $(this).data('options1').filter('[value1=' + id + ']'); 
    $('#parameters').html(options1);

  });

  $("#models").change(function() {

    // Show commands from selected model, on tooltip text
    $('#textHelpCommands').html("<strong>Commands:</strong><br>" + $("#models :selected").attr("commands"));

    document.getElementById("id").value = $("#models :selected").val();
    if ($("#models :selected").val() == "none" ) {
      document.getElementById("editmodel").style.display = "none";
      document.getElementById("helpCommands").style.display = "none";
    } else {
      document.getElementById("editmodel").style.display = "block";
      document.getElementById("helpCommands").style.display = "block";
    }
  });

function actionStart(that) {

    // Quando botão Start pressionado, especifica os valores do form   
    
    document.getElementById("name").value = $("#name1").val();
    document.getElementById("idmodel").value= $("#models :selected").val();
    document.getElementById("description").value = $("#description1").val();
    document.getElementById("notes").value = $("#notes1").val();

    if ($("#ip_list :selected").val() == "other") {
      document.getElementById("host").value = $("#otherIp").val();
    } else { document.getElementById("host").value = $("#ip_list :selected").val(); }

    //console.log($("#ip_list :selected").val());

    if ($("#ports_list :selected").val() == "other") {
      document.getElementById("ports").value = $("#otherService").val();
    } else { document.getElementById("ports").value = "<?php echo PORTS_NUMBERS; ?>"; }

    document.getElementById("domain").value= $("#domain1").val();
    document.getElementById("network").value= $("#network1").val();

}

function otherServiceCheck(that) {
  if (that.value == "other") {
    document.getElementById("otherService").style.visibility = "visible";
  } else {
    document.getElementById("otherService").style.visibility = "hidden";
  }
}

function otherIpCheck(that) {
  if (that.value == "other") {
    document.getElementById("otherIp").style.visibility = "visible";
  } else {
    document.getElementById("otherIp").style.visibility = "hidden";
  }
}

function modelChange(that) {
  // Ativa botão Start se modelo selecionado
  if (that.value == "none") {
    document.getElementById("buttonStart").disabled = true;
  } else { 
   // if (document.getElementById("test").value != "") {
    document.getElementById("buttonStart").disabled = false;
  }

  //console.log("> idmodel: " + $("#models :selected").val());
  if ($("#models :selected").attr("alert") == "1") {
    //document.getElementById('alertText').innerHTML = "<b>ATTENTION! This model has at least one tool that requires special attention!</b>";
    document.getElementById('alertText').innerHTML = 
    "<div id='formalert' class='w3-modal' style='display: block;'>" +
      "<div class='w3-modal-content w3-card-4 w3-animate-zoom' style='max-width:450px; border-radius: 10px;'>" + 
        "<div class='w3-center' style='padding-top: 10px;'>" +
          "<h5 style='margin-bottom: 0;'><b>ATTENTION!</b></h5>" + 
          "<p style='margin: 0 20px 15px'><?php echo ALERT ?></p>" + 
          "<form id='form' class='w3-container' style='padding-bottom: 20px;'>" +
             "<button style='width: 100px;' type='button' class='w3-btn w3-orange' onclick=\"document.getElementById('formalert').style.display='none'\"><i class='fa fa-check-circle'></i>OK</button>" +
          "</form>" + 
        "</div>" +
      "</div>" +
    "</div>";
  } else {
    // document.getElementById('alertText').innerHTML = "No alerts from the tools of this model.";
  }
}

</script>

</div>

</body>
</html>